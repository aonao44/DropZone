# DropZone 要件定義書（v0.9 / MVP ベース）

## 1. サービス概要

### 1.1 サービス名（仮）

DropZone

### 1.2 コンセプト

**「素材回収、もう催促しない。1 リンクで“提出漏れゼロ”」**
Web/LP/デザイン制作のための**提出フォーム生成 SaaS**。提出要件のガイド・自動チェック・期限管理・受領管理を一気通貫で提供。

### 1.3 ターゲットユーザー

- フリーランス/小規模制作事業者（Web 制作、LP 制作、バナー/デザイン受託）
- 毎案件で素材回収がバラバラになり、催促/手戻りに時間を取られている人

### 1.4 提供価値

- **漏れゼロ**：要件テンプレ＋自動バリデーションで不足を可視化
- **催促ゼロ**：期限・自動リマインドで能動的に回収
- **管理コスト最小**：提出一覧・不足タグ・ZIP 一括 DL（Pro）で運用を短縮

---

## 2. 機能要件

### 2.1 主要機能（MVP）

**機能 1：プロジェクト作成（管理者）**

- プロジェクト名、説明、提出期限（任意）、テンプレ選択（LP/コーポレート/バナー など 3 型）
- フォーム URL の自動生成（`/s/:slug`）

**機能 2：提出フォーム生成（クライアント用）**

- ログイン不要、ドラッグ＆ドロップ対応、スマホ最適
- 提出項目（初期）：ロゴ画像、キービジュアル、Figma リンク、任意メモ
- 入力ガイド（例：推奨サイズ・拡張子・背景/透過・Figma の共有設定）

**機能 3：自動バリデーション**

- 画像：拡張子（png/jpg/svg）、容量、最小 px、アスペクト比（任意）
- Figma：URL 形式（`figma.com/file/` 含むか）、http/https 判定
- 必須/任意の判定、未達項目は警告表示

**機能 4：提出完了＆再提出**

- 完了画面（お礼＋不足があれば案内）
- 再提出リンク（同一 URL で追送可／最新版が上書き、履歴は管理画面へ）

**機能 5：ダッシュボード（管理者）**

- 提出一覧（ステータス：未提出/一部不足/完了）
- 各提出の詳細（ファイルプレビュー、ダウンロード、メモ、タイムスタンプ）
- 不足項目のタグ付け（自動/手動）

**機能 6：リマインド（MVP はメール）**

- 期限 3 日前/前日/当日の自動メール（ON/OFF）
- 手動リマインド送信（自由文＋フォーム URL 差し込み）

**機能 7：料金/プラン**

- Free：プロジェクト数制限、ストレージ上限、Powered by 表示
- Pro：プロジェクト無制限、ZIP 一括 DL、CSV エクスポート、軽いホワイトラベル

### 2.2 必須機能（基礎）

**認証（管理者のみ）**

- Clerk による Email/Pass, Social 可（後日）
- セッション管理、パスワードリセット

**ストレージ/アップロード**

- UploadThing による署名付き URL
- ウイルス/マルウェア簡易スキャン（後追いでも OK、MVP は拡張性前提）

**データ管理**

- 提出閲覧/ダウンロード
- ステータス変更（不足 → 完了）
- プロジェクトのアーカイブ/削除

**課金（Pro）**

- Stripe（サブスク月額）
- Free→Pro のアップグレード/ダウングレード

---

## 3. 非機能要件

### 3.1 パフォーマンス

- 提出アップロード：5 秒以内（10MB 単位の目安、回線依存は除く）
- ダッシュボード一覧：初回表示 1.5 秒以内（20 提出想定）

### 3.2 ユーザビリティ

- モバイル最適（フォームは優先）
- クライアントは**ログイン不要**・2 ステップ以内で提出開始
- 何を出せばよいか一目で分かるミニガイド表示

### 3.3 セキュリティ/プライバシー

- HTTPS 必須、TLS1.2+
- アップロードは署名付き URL（短命）
- 保存期間・削除ポリシーの明記（例：プロジェクト削除 → 即論理削除、30 日後物理削除）
- RBAC（管理者のみ閲覧）
- 監査ログ（将来）／現状は重要イベント（作成/提出/削除）をイベントテーブルに記録
- 個人情報最小化、Cookie はセキュア/HttpOnly

### 3.4 可観測性

- 主要イベントに計測：フォーム表示、提出成功、提出失敗、リマインド送信、DL
- エラートラッキング（Sentry 等想定）

---

## 4. ユーザーフロー

1. 管理者ログイン → プロジェクト作成 → フォーム URL 発行
2. 管理者が URL をクライアントへ送付（メール/チャット）
3. クライアントが素材アップロード＋ Figma リンク提出 → 完了画面
4. 不足があればダッシュボードで可視化 → 自動/手動リマインド
5. すべて揃えばステータス「完了」 → Pro なら ZIP/CSV で受領

---

## 5. 画面構成

### 5.1 公開/一般

- **トップ**(`/`)：価値訴求、機能、料金
- **料金**(`/pricing`)：Free/Pro 比較、決済導線
- **提出フォーム**(`/s/:slug`)：クライアント用（ログイン不要）
- **提出完了**(`/s/:slug/done`)：お礼＋再提出導線

### 5.2 認証必須（管理）

- **ダッシュボード**(`/dashboard`)：プロジェクト一覧・提出状況
- **プロジェクト詳細**(`/dashboard/projects/:id`)：提出一覧、プレビュー、タグ、不足抽出
- **設定**(`/dashboard/settings`)：アカウント/課金/ブランド色（Pro はホワイトラベル）

### 5.3 共通コンポーネント

- ヘッダー（ロゴ、ナビ、ユーザーメニュー）
- トースト通知（提出成功/失敗/バリデーション警告）
- モーダル（リマインド送信、ZIP 生成待ち）

---

## 6. 仕様詳細

### 6.1 提出テンプレ（MVP）

- **LP テンプレ**

  - ロゴ（必須, png/svg, 最小横 512px, ≤5MB）
  - キービジュアル（必須, jpg/png, 1920×1080 以上推奨, ≤10MB）
  - Figma リンク（必須, `https://www.figma.com/file/…`）
  - 競合/参考 URL（任意, 複数）
  - 連絡先メール（任意）

- **コーポレート**：上記＋ブランドガイド（PDF 可, ≤20MB）
- **バナー**：ロゴ、想定サイズ（例：1200×628）、参考イメージ

> いずれも管理者側で必須/任意の切替可（MVP はテンプレ固定＋一部オプション）。

### 6.2 バリデーション（フロント＆サーバ）

- ファイル：拡張子/容量/px/アスペクトチェック
- Figma：URL パターン、プロトコル、クエリ（`?node-id=`任意）
- 不足/失敗時はその場でエラー表示＋ヘルプ（Figma 共有手順）

### 6.3 リマインド仕様

- 自動：期限 3 日前/前日/当日 09:00 送信（タイムゾーンは管理者設定/初期は JST）
- 手動：任意本文＋フォーム URL（テンプレ差し込み）

### 6.4 ダッシュボード表示

- リスト：提出者（匿名/名称未設定時は「未入力」）、進捗%、不足タグ、最終更新、期限まで日数
- 詳細：各アセットのプレビュー/メタ（幅 × 高さ/拡張子/容量）、DL ボタン、コメントメモ欄

### 6.5 受領/エクスポート（Pro）

- ZIP 一括 DL（サブディレクトリ：`/project-name/submitter-yyyymmdd/`）
- CSV（提出者、提出日時、項目別ステータス、URL）

---

## 7. データモデル（MVP 想定 / Prisma）

```
User(id, email, role[admin], createdAt,…)
Project(id, ownerId(ref User), name, description, slug, dueDate, templateType[LP/CORP/BANNER], status[active/archived], createdAt,…)
Submission(id, projectId, clientEmail?, clientName?, status[pending/partial/complete], progressPct, createdAt, updatedAt)
Asset(id, submissionId, type[logo/kv/figma/guide/other], fileKey?, fileUrl?, width?, height?, bytes?, ext?, isValid, validationErrors[], createdAt)
Event(id, projectId?, submissionId?, type[created/submitted/reminded/downloaded/…], payload JSON, createdAt)
Plan(id, userId, tier[free/pro], stripeCustomerId, stripeSubId, status[active/canceled], createdAt)
```

---

## 8. API（Next.js API Routes / 例）

- `POST /api/projects`：プロジェクト作成（認証必須）
- `GET /api/projects/:id`：詳細取得
- `POST /api/projects/:id/remind`：手動リマインド送信
- `GET /api/submissions?projectId=…`：提出一覧
- `POST /api/submissions/:id/assets`：アセット登録（署名 URL で実体は UploadThing へ）
- `POST /api/export/:projectId/zip`（Pro）：ZIP 生成ジョブ起動
- `GET /api/export/:jobId`：ジョブ状態/ダウンロード URL

---

## 9. 技術仕様

- **フロント**：Next.js 15 (App Router) / TypeScript / Tailwind CSS / shadcn/ui
- **フォーム**：react-hook-form + zod
- **アップロード**：UploadThing（署名付き、ドラッグ＆ドロップ）
- **DB**：Prisma + Postgres（Supabase/Neon いずれか）
- **認証**：Clerk（管理者のみ）
- **課金**：Stripe（サブスク／計測は Webhook で Plan 更新）
- **日時**：date-fns, date-fns-tz
- **通知**：Resend（メール）※代替可
- **ホスティング**：Vercel
- **監視**：Sentry（エラー）/ Log Drains（イベント）
- **テスト**：E2E は後回し（MVP はスモーク＋型）

### 開発上の注意

- クライアントは**匿名提出可**（メール任意）。識別が必要なら`clientEmail`を必須化オプション。
- 署名 URL の TTL は短く（例：5 分）。
- ZIP 生成はサーバレスのタイムアウトを避けるため**ジョブ化**（ストレージ連携 or Edge 不可ならキュー/ワーカーを後日）。
- プレビューは画像のみ（MVP）。PDF 等はアイコン表示＋ DL。
- 物理削除はキューでバッチ処理（30 日後）。

---

## 10. エラーハンドリング／空状態

- **フォーム空状態**：提出項目の説明とサンプル画像
- **バリデーション失敗**：フィールド下に理由（例：解像度不足 512×512 以上）
- **期限超過**：提出自体は可（ラベル「期限超過」付与）、管理画面でフィルタ可能
- **ZIP 失敗**：再試行ボタン＋サポート連絡先表示

---

## 11. 分析/KPI

- **TTAF（All Files までの時間）**：フォーム発行 → 全必須提出完了の中央値
- **不足率**：初回提出時に要件未達だった項目割合
- **リマインド回数/案件**：自動/手動合計
- **Free→Pro 転換率**：ZIP/CSV 利用時の転換を計測
- **プロジェクト完了率**：期限内完了の割合

---

## 12. 料金体系（初期案）

### Free

- プロジェクト：3 件まで
- ストレージ：合計 3GB
- テンプレ：1 種 / Powered by 表示
- 自動リマインド：最大 1 回

### Pro（¥1,480〜¥1,980/月）

- プロジェクト無制限 / ストレージ 100GB（超過は従量・後日）
- ZIP 一括 DL / CSV エクスポート
- テンプレ 3 種＋軽いカスタム、ブランド色/ロゴ反映
- 自動リマインドフル（3 回） / 手動テンプレ保存

（将来）Team/Studio：権限、監査ログ、外部ストレージ連携、カスタムドメイン

---

## 13. ロードマップ（6 ヶ月概要）

- **M0–1（MVP）**：プロジェクト/提出フォーム/バリデーション/ダッシュボード/メールリマインド
- **M2–3**：ZIP/CSV（Pro）、ホワイトラベル、テンプレ拡充、手動リマインド強化
- **M4–6**：クライアントポータル（履歴/再提出）、チーム権限、Drive/Dropbox/S3 連携、Slack 通知

---

## 14. 成功条件（受け入れ基準の例）

- 管理者が**3 分以内**にプロジェクト作成 → フォーム URL を発行できる
- クライアントが**2 分以内**にロゴ/KV/Figma を提出できる（平均）
- 不足の自動判定で初回提出の**不足率が 20%低下**（ベータ比較）
- Pro 課金：初月 Free→Pro 転換率 **≥ 5%**

---

## 15. メール/文面（テンプレ：抜粋）

- **招待**：「素材のご提出をお願いします（DropZone）」＋提出期限＋ URL
- **自動リマインド（前日）**：「明日が提出期限です」＋不足項目の要約
- **完了**：「受領しました」＋不足があれば一覧

---

# DropZone 開発ロードマップ（MVP）

## 概要

本ドキュメントは、提出フォーム SaaS「DropZone」MVP の実装順序とタスクリストを定義します。
コア価値（素材回収の漏れ削減・期限運用・一覧管理）を最短で成立させ、Pro 課金（ZIP/CSV）まで到達します。

---

## 開発フェーズ

### フェーズ 1: 基盤・認証・DB・アップロード（推定: 3–4 日）

**完成度の高い基盤を一気に整備。** 認証（管理者のみ）、DB/Prisma、UploadThing、UI キット。

#### 実装内容

- [ ] **環境構築**

  - Next.js 15 / TS / Tailwind / shadcn/ui / react-hook-form / zod / date-fns
  - Sentry（エラートラッキング）、ESLint/Prettier
  - `.env.local` 初期化（Clerk, Database URL, UploadThing, Resend, Stripe）

- [ ] **認証（管理者のみ）**

  - ClerkProvider + `middleware.ts`（/dashboard 配下保護）
  - `/sign-in` `/sign-up`（UI 最小）
  - セッション取得ユーティリティ（server components 用）

- [ ] **DB/スキーマ（Prisma + Postgres）**

  - モデル：User / Project / Submission / Asset / Event / Plan
  - 初期マイグレーション・種データ（テンプレ種別）

- [ ] **アップロード基盤**

  - UploadThing（署名付き URL・ドラッグ&ドロップ）
  - アップロード制限（拡張子/容量）と TTL 設定

- [ ] **共通 UI/レイアウト**

  - ヘッダー（ログイン時のユーザーメニュー）
  - トースト/ローディング/エラーバウンダリ

- [ ] **監視/ログ**

  - 重要イベント（作成/提出/失敗）を Event へ記録

**Done 条件**

- 認証済ユーザのみ `/dashboard` に入れる
- Prisma migrate 成功、Event にログが残る
- 10MB 画像のアップロードが UI 経由で成功

---

### フェーズ 2: プロジェクト & 提出フォーム生成（推定: 2–3 日）

**URL ひとつで提出を開始できる状態**まで。

#### 実装内容

- [ ] **プロジェクト作成**

  - `/dashboard/projects/new`（名称/説明/期限/テンプレ選択）
  - スラッグ生成 `/s/:slug`

- [ ] **公開フォーム（ベース）**

  - `/s/:slug`（ログイン不要）
  - テンプレに応じた項目レンダリング（LP/Corp/Banner の 3 型）
  - 入力ガイド（推奨サイズ/拡張子/Figma 共有ヘルプ）

- [ ] **提出完了**

  - `/s/:slug/done`（再提出導線・注意書き）

- [ ] **API/Server Actions**

  - プロジェクト CRUD
  - フォームのプリセット取得

**Done 条件**

- 管理者が 3 分以内にフォーム URL を発行できる
- 未認証でも `/s/:slug` にアクセスし提出開始できる

---

### フェーズ 3: 提出 & バリデーション（推定: 3–4 日）

**“漏れ/不備を減らす”コア価値の実装。**

#### 実装内容

- [ ] **ファイル検証（フロント+サーバ）**

  - 拡張子（png/jpg/svg 等）・容量・最小 px・アスペクト比
  - 失敗時のフィールド別エラー表示

- [ ] **Figma リンク検証**

  - URL 形式（`https://www.figma.com/file/`）・プロトコル
  - 共有手順ミニヘルプ

- [ ] **提出データ登録**

  - Submission 作成、Asset 登録、進捗%計算
  - 再提出時：最新版上書き＋履歴は Event で保持

- [ ] **完了画面/再提出**

  - 同 URL で追送可、完了 →done 画面へ

- [ ] **イベント記録**

  - submitted/validation_error など

**Done 条件**

- 初回提出で各項目の適否が即時分かる
- 同一 URL から再提出し、最新状態がダッシュボードに反映

---

### フェーズ 4: ダッシュボード & 管理機能（推定: 2–3 日）

**見える化と不足抽出で運用を楽に。**

#### 実装内容

- [ ] **一覧**

  - `/dashboard`：プロジェクト一覧（進捗％/期限/ステータス）
  - `/dashboard/projects/:id`：提出一覧（未提出/部分/完了・更新日時・不足タグ）

- [ ] **詳細**

  - プレビュー（画像メタ：W×H/拡張子/容量）
  - 不足タグ（自動/手動付与）
  - 管理メモ

- [ ] **フィルタ/ソート**

  - 期限超過・ステータス・更新日

- [ ] **手動リマインド（下準備）**

  - モーダル起動・本文テンプレ保存（送信は後続フェーズ）

**Done 条件**

- 一覧から不足案件を素早く特定できる
- 詳細でアセット適否と不足理由が明確

---

### フェーズ 5: 期限・リマインド（メール）（推定: 2 日）

**催促ゼロ運用の核。**

#### 実装内容

- [ ] **リマインドスケジューラ**

  - Vercel Cron で 3 日前/前日/当日 09:00（JST）送信
  - タイムゾーン設定（当面は JST 固定でも可）

- [ ] **メール送信（Resend）**

  - 招待／自動リマインド／完了テンプレ

- [ ] **手動リマインド**

  - ダイアログから本文編集 → 送信

- [ ] **イベント/監査**

  - reminded イベント記録、送達結果のログ

**Done 条件**

- 期限付き案件で自動メールが規定タイミングに送れる
- ダッシュボードから手動リマインドが送れる

---

### フェーズ 6: Pro 課金（ZIP/CSV/ブランド色）（推定: 3–4 日）

**マネタイズ到達。**

#### 実装内容

- [ ] **Stripe（サブスク）**

  - プラン：Free / Pro（月額）
  - Webhook で Plan 更新 →`Plan`反映
  - ガード：`hasPro(user)`で機能制御

- [ ] **ZIP 一括 DL（ジョブ化）**

  - エンドポイント起動 → バックグラウンドで ZIP 生成
  - 完了後 DL URL 発行、失敗時リトライ

- [ ] **CSV エクスポート**

  - 提出者/日時/項目別ステータス出力

- [ ] **ブランド色/ロゴ（軽ホワイトラベル）**

  - フォームヘッダーに反映（Pro）

**Done 条件**

- 課金 → 即 Pro 機能（ZIP/CSV/ブランド）が有効
- 大量ファイル（例: 合計 150MB）でも ZIP が生成・DL できる

---

### フェーズ 7: 公開ページ & マーケ（推定: 1–2 日）

**獲得導線の整備。**

#### 実装内容

- [ ] **トップ/料金**

  - 価値訴求・機能・プラン比較（Free vs Pro）
  - CTA と FAQ、利用規約/プライバシー

- [ ] **導入フロー**

  - 「3 分でフォーム発行」チュートリアル

- [ ] **計測**

  - LP→ サインアップ → 初回プロジェクト作成のファネル

**Done 条件**

- 新規ユーザーが LP→ サインアップ → フォーム作成まで自走可能

---

### フェーズ 8: 本番デプロイ＆品質確認（推定: 1 日）

**安定稼働へ。**

#### 実装内容

- [ ] **本番デプロイ**

  - Vercel / 環境変数 / DB 本番 / Clerk 本番 / ドメイン

- [ ] **セキュリティ最終確認**

  - HTTPS/セッション/Cookie 属性、署名 URL TTL、削除ポリシー記載

- [ ] **スモークテスト**

  - 主要ユースケースの手動チェックリスト

- [ ] **SLA/サポート動線（軽）**

  - お問い合わせメール、ステータスページ（簡易）

**Done 条件**

- 主要フローが本番で無停止動作（24h）
- 重大エラーなし、基本メトリクス取得可能

---

## タスク一覧（抜粋・詳細）

### API Routes / Server Actions

- [ ] `POST /api/projects`（作成） / `GET /api/projects/:id`（取得）
- [ ] `POST /api/submissions`（作成） / `GET /api/submissions?projectId=…`
- [ ] `POST /api/assets`（登録） / 署名 URL 発行
- [ ] `POST /api/remind`（自動/手動送信トリガ）
- [ ] `POST /api/export/:projectId/zip`（Pro） / `GET /api/export/:jobId`
- [ ] `POST /api/export/:projectId/csv`（Pro）
- [ ] Stripe Webhook `/api/stripe/webhook`（plan 更新）

### バリデーション/UX

- [ ] 画像: ext/bytes/min px/aspect（zod + サーバ再検証）
- [ ] Figma: URL パターン・ヘルプリンク
- [ ] エラーメッセージの具体化（例: 「横 1920px 以上にしてください」）

### 通知/メール

- [ ] 招待/リマインド/完了テンプレ（ブランド一致）
- [ ] 送達/バウンスのロギング

### ZIP/CSV

- [ ] ZIP 生成ジョブ（タイムアウト回避）とジョブ状態管理
- [ ] CSV: 不足項目・適否・更新日時

---

## 受け入れ基準（E2E 基準・計測）

- [ ] **TTAF 中央値 ≤ 3 日**（ベータ 5 社の平均）
- [ ] **不足率（初回）20%改善**（テンプレ＆検証導入前比）
- [ ] **フォーム発行 ≤ 3 分 / 提出開始 ≤ 2 分**
- [ ] **Free→Pro 転換 ≥ 5%（初月）**
- [ ] 期限付き案件の**自動メール送達率 ≥ 98%**

---

## リスク & 回避策（MVP 内）

- **「フォームで代替できる」印象** → テンプレ/検証/リマインド/不足タグを先に仕上げる
- **ZIP 時間超過** → ジョブ化＋分割圧縮、失敗時再試行
- **権限ミス（Figma）** → ガイドの強化とチェックリスト化
- **ストレージ肥大** → Free は 3GB、プロジェクトアーカイブで 30 日後物理削除

---

## デプロイ前チェックリスト（最終）

- [ ] 署名 URL TTL 短命化 / 公開権限の再点検
- [ ] 期限メールの JST 送信確認（Cron 稼働）
- [ ] Stripe Webhook 本番キー差し替え・リプレイ対策
- [ ] 重要ログ（submitted、reminded、downloaded）が Event に残る
- [ ] プライバシー/削除ポリシーの LP 明記

---

## ポスト MVP バックログ（優先度順）

1. **Slack 通知**（提出/不足/期限超過）
2. **クライアントポータル**（履歴・再提出・進捗％）
3. **外部ストレージ連携**（Drive/Dropbox/S3 “コピーせず連携”）
4. **チーム/権限**（閲覧/コメント/管理）
5. **テンプレマーケット**（配布/販売）

---
